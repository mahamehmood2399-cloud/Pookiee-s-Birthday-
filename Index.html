<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pookie Cookie â€” Magical Curtain Countdown</title>
<style>
  /* ... your existing CSS (same as before) ... */
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Good Morning Mr. Pookie Cookie ðŸ’›</h1>
      <div class="sub">A short note: You make every day warmer and brighter â€” welcome to your month of little surprises.</div>
    </div>
  </header>

  <main id="main">
    <div class="card fadeIn">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div style="font-weight:800;color:var(--muted)">Progress</div>
        <div class="small">Tap each block to reveal its content. Blocks unlock by date or after you open the previous one.</div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px" id="progressDots"></div>
    </div>

    <div id="pages"></div>

    <div class="card small">
      <strong>How it works</strong>
      <ul style="text-align:left;margin:8px 0 0 18px;color:#c9be98">
        <li>Tap the curtain to begin â€” it dissolves in sparkles and reveals the intro.</li>
        <li>Block 1 is unlocked after curtain; each block unlocks by date (Dec 1,5,10,15,20,25,30) or when you finish the previous block.</li>
        <li>All answers are saved locally and exportable in Admin view. Gift contents are never shown publicly.</li>
      </ul>
    </div>
  </main>
</div>

<!-- Admin + Export (no password) -->
<button id="adminToggle" title="Toggle Admin View">Admin</button>
<button id="exportBtn" title="Export answers">Export answers</button>

<!-- Curtain overlay -->
<div id="curtainOverlay" aria-hidden="false">
  <canvas id="curtainSparkles"></canvas>
  <div id="curtainText">Tap to open the surprise</div>
  <div style="margin-top:8px;color:rgba(212,175,55,0.9)">A little magic awaits inside</div>
</div>

<!-- fireworks canvas (hidden until final) -->
<canvas id="fireworksCanvas"></canvas>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.30.0/firebase-app.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.30.0/firebase-database.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAxrxUO86_bBRWvG7MPPEiplyMZcP_BBaw",
    authDomain: "mr-pookie-birthday.firebaseapp.com",
    databaseURL: "https://mr-pookie-birthday-default-rtdb.firebaseio.com",
    projectId: "mr-pookie-birthday",
    storageBucket: "mr-pookie-birthday.appspot.com",
    messagingSenderId: "440258697166",
    appId: "1:440258697166:web:c561f120ea13d7a234bd9f"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // Save answer to Firebase
  function saveToFirebase(blockIdx, key, value) {
    const path = `answers/block${blockIdx}/${key}`;
    set(ref(database, path), value).catch(err => console.error("Firebase save error:", err));
  }

  window.saveToFirebase = saveToFirebase; // make global so other scripts can call it
</script>

<script>
/* ===========================
   Your existing JS code (curtain, progress, fireworks, etc.)
   =========================== */

const STORAGE_KEY = 'pookie_full_state_v1';
let state = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"progress":0,"answers":{}}');
let adminMode = localStorage.getItem('pookie_admin') === '1';

/* ---------------------------
   Save answer (local + Firebase)
   --------------------------- */
function saveAnswer(blockIdx, key, value){
  state.answers = state.answers || {};
  state.answers['block'+blockIdx] = state.answers['block'+blockIdx] || {};
  
  // store locally
  if(String(key).toLowerCase().includes('gift')) {
    state.answers['block'+blockIdx][key] = 'CHOICE_MADE';
  } else {
    state.answers['block'+blockIdx][key] = value;
  }
  state.answers['block'+blockIdx].completed = true;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

  // store remotely in Firebase
  if(window.saveToFirebase){
    saveToFirebase(blockIdx, key, state.answers['block'+blockIdx][key]);
  }

  // update UI
  populateSaved();

  // unlock next block
  if(state.progress < blockIdx+1 && blockIdx < BLOCK_CONTENT.length){
    state.progress = blockIdx+1;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    renderAll();
  }
}

/* ---------------------------
   Other helper functions (populateSaved, renderAll, etc.)
   Use exactly as in your original code
   --------------------------- */

</script>
</body>
</html>
